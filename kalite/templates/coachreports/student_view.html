{% extends "coachreports/base_google_visualization.html" %}

{% load i18n %}
{% load my_filters %}
{% load staticfiles %}
{% block coachreports_active %}{% endblock coachreports_active %}
{% block selfreports_active %}active{% endblock selfreports_active %}
{% block navbar_topics %}{% endblock navbar_topics %}
{% block navbar_makelink %}{% endblock navbar_makelink %}
{% block report_title %}User report{% endblock report_title %}
{% block title %}User report{% endblock %}

{% block headjs %} {{ block.super }}
<script type="text/javascript" src="/static/js/coachreports/scatter_view.js"></script>
<!--script type="text/javascript" src="/static/js/coachreports/timeline_view.js"></script-->
{% endblock headjs %}

{% block headcss %} {{ block.super }}
<link rel='stylesheet' type='text/css' href='{% static "css/coachreports/scatter_view.css" %}'>
<!--link rel='stylesheet' type='text/css' href='{% static "css/coachreports/timeline_view.css" %}'-->
<style>
tr.invisible { display:none; }
td.pct, td.float, td.int { text-align: right; }
td.struggling { background-color: #aa0; font-weight: bold; %}
</style>
{% endblock headcss %}

{% block content %}
{% block navbar %}{{ block.super }}{% endblock navbar %}

<h2>Topics Table</h2>
<table>
    <tr>
        <th>&nbsp;</th>
        <th>{% trans "Topic name" %}</th>
        {% for def in stat_defs %}
        <th>{{ def.title }}</th>
        {% endfor %}
    </tr>
    
{% for topic in topics %}
    <tr class="{% if exercise_logs|get_item:topic.id %}visible{% else %}invisible{% endif %}">
        <td>
            <div class="progress-circle {% if stats|get_item:topic.id|get_item:'pct_mastery' = 1.0 %}complete{% else %}partial{% endif %}">
            &nbsp;
            </div>
        </td>
        <td>
            <span title="{{ topic.description }}">
                <a href="{{ topic.path }}">{{ topic.title }}</a>
            </span>
        </td>
        {% for def in stat_defs %}
        <td class="{{ def.type }}{% if def.key == 'total_struggling' and stats|get_item:topic.id|get_item:def.key > 0 %} struggling{% endif %}"">
            {% if def.type == "float" %}
                {{ stats|get_item:topic.id|get_item:def.key|floatformat }}
            {% elif def.type == "pct" %}
                {{ stats|get_item:topic.id|get_item:def.key|percent:1 }}
            {% elif def.type == "date" %}
                {{ stats|get_item:topic.id|get_item:def.key|date:"SHORT_DATE_FORMAT" }}
            {% elif def.key != "total_struggling" %}
                {{ stats|get_item:topic.id|get_item:def.key }}
            {% else %}
                {% for exercise_log in exercise_logs|get_item:topic.id %}
                    {% if exercise_log.struggling %}
                        {% cycle 'a' 'b' 'c' 'd' 'e' 'f' 'g' 'h' 'i' 'j' 'k' 'l' 'm' 'n' 'o' 'p' as letter silent %}
                        {% for exercise in exercises|get_item:topic.id %}
                            {% if exercise.name = exercise_log.exercise_id %}
                            <a href="{{ exercise.path }}">{{ letter }}</a>
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                {% endfor %}
            {% endif %}
        </td>
        {% endfor %}
    </tr>
{% endfor %}
</table>
{% block endjs %}{{ block.super }}{% endblock endjs %}
{% endblock content %}
