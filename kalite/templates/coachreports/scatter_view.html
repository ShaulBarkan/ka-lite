{% extends "coachreports/base.html" %}

{% load my_filters %}

{% block headjs %} {{ block.super }}
<!-- option 1: https://github.com/stringfellow/raphael-scatter -->
<!--script type="text/javascript" src="/static/js/jquery-1.7.1.min.js"></script-->
<script type="text/javascript" src="/static/js/raphael-min.js"></script>
<script type="text/javascript" src="/static/js/raphael.scatter.js"></script>
<script>
    var sp, sp2;

    window.onload = function () {
        var data = [
                      {% for user, vals in data.data.items %}
                      [{{ vals|get_item:form.xaxis }}, {{ vals|get_item:form.yaxis }}, {"text": '<div><a href=""><u><b>{{ data.users|get_item:user }}</b></u></a></div>'}],
                      {% endfor %}
                      ]
        sp = new scatterPlot(
            {   x_label: "X LABEL", 
                "size": 600,
                colours: [  // gradient colours
                    ['#FFF', 0],
                    ['#fff', 37.5],
                    ['#fff', 62.5],
                    ['#fff', 100]
                ],
                series_colours: ['#f00', '#00f'],
        //        ticks: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10],  //ticks.. obv.
                xticks: [0, 0.2, 0.4, 0.6, 0.8, 1.0],
                yticks: [0, 20, 40, 60, 80, 100]
            }, 
            "holder",
            {"series1": data}
        );

        console.log(data);
        var loaderText = function (elem) {
            $('#loader').html(elem.data('text'));
        };
    };
</script>

<!-- option 2 -->
<script type="text/javascript" src="/static/js/google.jsapi.js"></script>

<script type="text/javascript">
//  google.load("visualization", "1", {packages:["corechart"]});
if (window['google'] != undefined && window['google']['loader'] != undefined) {
if (!window['google']['visualization']) {
window['google']['visualization'] = {};
google.visualization.Version = '1.0';
google.visualization.JSHash = '4c2447db544d51e9c1e1331ad8007df0';
google.visualization.LoadArgs = 'file\75visualization\46v\0751\46packages\75corechart';
}
google.loader.writeLoadTag("script", "/static/js/google.corechart.js", false);
}
</script>
<script type="text/javascript">
  google.setOnLoadCallback(drawChart);
      function drawChart() {

          var data = google.visualization.arrayToDataTable([
      ['{{ form.xaxis }}', '{{ form.yaxis }}'],
      {% for user, vals in data.data.items %}
      [{{ vals|get_item:form.xaxis }}, {{ vals|get_item:form.yaxis }}],
      {% endfor %}
    ]);

     var dataTable = new google.visualization.DataTable();
      dataTable.addColumn('number', '{{ form.xaxis }}');
      dataTable.addColumn('number', '{{ form.yaxis }}');
      // A column for custom tooltip content
//      dataTable.addColumn({type: 'string', role: 'tooltip'});
      dataTable.addColumn({'type': 'string', 'role': 'tooltip', 'p': {'html': true}});
      dataTable.addRows([
      {% for user, vals in data.data.items %}
      [{{ vals|get_item:form.xaxis }}, {{ vals|get_item:form.yaxis }}, '<div><a href=""><u><b>{{ data.users|get_item:user }}</b></u></a></div>'],
      {% endfor %}
      ]);
    var options = {
      title: '{{ form.xaxis }} vs. {{ form.yaxis }} comparison',
      hAxis: {title: '{{ form.xaxis }}', minValue: 0, maxValue: 1},
      vAxis: {title: '{{ form.yaxis }}', minValue: 0, maxValue: 50},
      legend: 'none',
      tooltip: { isHtml: 'true', trigger: 'selection' }
    };

    var chart = new google.visualization.ScatterChart(document.getElementById('chart_div'));
    
/*//    chart.draw(data, options);
 chart.setAction({
      visible: function() { return true },
      enabled: function() { return true },
      id: 'sample',                  // An id is mandatory for all actions.
      text: 'See sample book',       // The text displayed in the tooltip.
      action: function() { 
      alert("1");
        }
    });
*/
        chart.draw(dataTable, options);
  }
</script>
{% endblock headjs %}


{% block headcss %} {{ block.super }}
<style>
#table div { margin-top: 25px; }
</style>
{% endblock headcss %}


{% block content %}

{{ form }}

<div id="google">
    <div id="chart_div" style="width: 900px; height: 500px;"></div>
</div>

<div id="raphael-scatter">
    <div id="holder"></div>
    <div id="holder2"></div>
    <div id="loader"></div>
</div>

<div id="table">
    <div>
        <table>
            <tr>
                <th>users</th>
                <th>xaxis: {{ form.xaxis }}</th>
                <th>yaxis: {{ form.yaxis }}</th>
            </tr>
        {% for user, vals in data.data.items %}
            <tr>
                <td>{{ data.users|get_item:user }}</td>
                <td>{{ vals|get_item:form.xaxis }}</td>
                <td>{{ vals|get_item:form.yaxis }}</td>
            </tr>
        {% endfor %}
        </table>
    </div>

    <div id="raw">
    Form fields: <br/>
       {{ form }}
    </div>
    <div>
    Data blob: <br/>
        {{ data }}
    </div>
</div>
{% endblock content %}
