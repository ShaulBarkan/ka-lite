{% extends base_template %}

{% block title %}{{ zone.name }} - Zone Management Console{% endblock title %}
{% block management_active %}active{% endblock management_active %}

{% block headcss %}
    <link  rel="stylesheet" type="text/css" href="/static/css/management.css" />
{% endblock headcss %}

{% block content %}
<div id="zone_container">

    <div class="titlebar">
        <ul class="titlebar__title">
            {% if org %}
            <li><a href="{% url org_management %}"> {{ org.name }}</a></li>
            {% endif %}
            <li>
                {% if org %}&gt; {% endif %}{{ zone.name }}
                <a class="edit-link" href="{% url zone_form org_id=org.id zone_id=zone.id %}">(edit)</a>
            </li>
            <ul class="titlebar__buttons">
                <li>
                    <form name="upload_form" id="upload_form" method="post" 
                          action="{% url zone_data_upload org_id=org.id zone_id=zone.id %}"
                          enctype="multipart/form-data" >{% csrf_token %}
                        <div id="form_data">
                            <br/>
                            {{ upload_form.as_p }}
                        </div>
                        <input class="add green_button" type="submit" value="Bulk upload zone data">
                    </form>
                </li>
                <li><a class="green_button" href="{% url zone_data_download org_id=org.id zone_id=zone.id %}">Download all zone data</a></li>
            </ul>
        </ul>
    </div>


	<div class="facilities">
        <h2>Facilities</h2>
        
        {% if not facilities %}
            <p>You currently have no devices that save synced data with the central server</p>

        {% else %}

         <table class="simple-table">
            <tr>
                <th width="250px">Facility Name</th>
                <th width="100px">Reports</th>
                <th width="100px"></th>
                <th width="80px"># users</th>
                <th width="80px"># groups</th>
            </tr>
        
            {% for id,facility in facilities.items %}
                <tr>
                    <td>
                        <a href="{% url facility_usage org_id=org.id zone_id=zone.id facility_id=id %}">
                            {{ facility.name }}
                        </a>
                    </td>

                    <td>[<a href="{% url facility_usage org_id=org.id zone_id=zone.id facility_id=id %}">usage report</a>] </td>
                    <td>[<a href="{% url facility_mastery org_id=org.id zone_id=zone.id facility_id=id %}">mastery report</a>] </td>
                                        
                    <td>{{ facility.num_users }}</td>
                    <td>{{ facility.num_groups }}</td>
                </tr>
            {% endfor %}

        </table>
        {% endif %}
    </div>

    <div class="devices">
        <h2>Devices</h2>

        {% if not devices %}
            <p>You currently have no devices that save synced data with the central server</p>

        {% else %}
            <table class="simple-table">
                <tr>
                    <th width="250px">Device name</th>
                    <th width="200px"># Times Synced</th>
                    <th width="200px">Last Time Synced</th>
                    <th width="200px">Download</th>
                </tr>
                {% for id,device in devices.items %}
                    <tr>
                        <td>
                            <a href="{% url device_management org_id=org.id zone_id=zone.id device_id=id %}">
                                {{ device.name }}
                            </a></td>
                        <td>{{ device.num_times_synced }}</td>
                        <td>{{ device.last_time_synced }}</td>
                        <td>
                            <a class="green_button" href="{% url device_data_download org_id=org.id zone_id=zone.id device_id=id %}">
                                Download device data
                            </a>
                        </li>
</td>
                    </tr>

                {% endfor %}
            </table>
        {% endif %}
    </div>
    <div>

<script>
$("#form_data").hide()
$("#upload_form").submit(function() {
    // First press: show file entry
    if ($('#form_data').filter(":visible").length==0) { 
        $('#form_data').show();
        return false;
    }
    // Second press: submit form (default)
});
</script>

</script>
{% endblock content %}